# SmartHomeManager -- Automated Residential Systems Controller 2.0

## Description
This project aims to build a centralized, intelligent, and adaptable home automation platform. SmartHomeManager provides control and automation to various aspects of your house including heating/ cooling, lightning system (including smartbul bs and color), window shades control (automatic open close), as security systems integration, as monitoring of the enviro ment (temp/ humidity).

It allows seamless integration via a REST API, a modern UI (React frontend), and a powerful Python backend for core logic. Our core philosophy has to ensure privacy and flexibility.  All sensor data stays within local, user defined, storage.  The user always is responsible, and we only offer the means. 

Currently supporting integrations to Zigbee, Z- Wave and cloud connected device protocols, the project' future goals are supporting additional devices and more robust local- only functionality without the need external services or the need to use external protocols. SmartHomeManager is built for users with some technological skills that are not afraid of tinkering.

The system is built with asynchronous programming principles to allow for a high responsiveness and scalability. This enables it to process a large stream of data, while still allowing to control devices in real-time. Modular code design ensures a high maintainabily of the system.

Our architecture prioritizes safety as a first concern. Data encryption, authentication mechanisms are built into this project and is constantly being monitored. We encourage and welcome contribution that improve security of SmartHomeManager to the wider community.  The ultimate goal remains a user centric, customizable automation environment that puts user data under control.

## Installation Instructions
This project is designed for Linux/ macOS, while a Windows installation is supported but may require additional steps.

Before anything is started we highly encourage a virtual environment to be setup for all dependencies to avoid any conflicts between existing libraries that are available on your system. A virtual environment can be easily generated via:  `sudo apt-get install python python-dev python setuptools pip virtualenv python-pyudev`.

Next we recommend the creation of the project's root directiory, then within it you'll create your venv environment using  `virtualenv venv`. After the virtual environment is properly set up please, activate the new virtual environment. On linux systems it is `source venv/bin/activ ate` and macOS is very similar at  `source venv/bin/activate`.

Now, you need to install our project's requirements from the ` requirements file`. We highly encourage you update pip, prior to this command: `pip install --upgrade pip`. Then, execute:  
`pip install -r requirements.txt`.

If you are planning to install the web UI (using React), make sure you'll have Node, and NPM, or similar, installed. You can install these with apt, brew, or download the required installers and run them accordingly.

To setup the database we are utilizing PostgreSQL (version 12 or superior is suggested), so it needs an installation prior the execution of  `python setup_db scripts/populate_db.py` that handles the database creation and the population of the necessary initial data to run the system smoothly.

For Z-Wave, Zibgee devices, a Z- Wave USB dongle, and an Zibgee USB are required and the system will attempt auto detect it when the server application begins it execution process.  If this auto detection doesn;t works it's likely your device needs manual intervention via a dedicated tool such a zigbee2mqtt, or other tools.

You may require additional permissions such as `sudo`, for specific hardware to interact appropriately. The user who runes the project has to have permissions to all USB device you want controlled and/or access by the application utilities. Please ensure your firewalls have exceptions configured if needed, particularly for incoming and outgoing requests.

Lastly if running Docker you have a dedicated `Dockerfile` available at root to facilitate deployment in containers using a simple and repeatable deployment strategy.  We encourage your utilization. `docker build --tag smart-home-manager .` and the execution  `docker run -d --name smarthome-container smart-home-manager`.

This is not comprehensive but is designed to be an effective installation method to run this application smoothly. For advanced deployment or configuration consult with a qualified professional.

## Usage Instructions
SmartHomeManager has an easy to utilize, yet powerful, interface and controls to allow users manage the devices conviniently. It's possible control all devices via REST and through an intuitive and dynamic user-friendly HTML/ Javascript frontend UI built upon the powerful and popular library `React`.

Basic device control requires sending a HTTP PUT or GET request via the `/api/<deviceid>/<action>` endpoints to control your house's equipment in an extremely intuitive way.  You may need a dedicated utility that supports such request format.

You could send requests to turn lights on, change temperatures, raise/ lower curtains and much more by following a basic syntax as follow:  `curl http://localhost:5000/api/light-1/on`. For getting values from sensor you should send the equivalent `GET` commands: `curl http://localhost:5000/api/temperature/current` and receive a simple numeric response in a `JSON` string.

You can configure schedules through the WebUI for all actions. Schedules allows setting automation to control your appliances at a particular time during the days, or in relation with specific environmental data. For a complex schema and schedule setup is advised you'll consult the API Documentation or our extensive tutorials online, and also available via help at UI and terminal execution options.

To run tests and validate code and even simulate a real environment use `./scripts/run_ tests.sh` that utilizes an available framework, which allows a complete code test coverage for our system with high quality, with all edge cases tested, for an easy debugging if potential error arises in future code releases. It runs the tests suite as the application begins running on your terminal with `make` as dependency to create an optimized binary for deployment

If a specific sensor isn\'t displaying values or actions seem not available try rebooting and checking your logs as well. If that still doesnt' works contact with the development team for advanced assistance on troubleshooting your particular issue and potential solutions, for future updates,

This allows both experienced developers and novices in smart house technologies manage a house, with minimal technical intervention from their behalf. This is very helpful if a sudden error appears on system and needs manual troubleshooting

## Configuration
SmartHomeManager utilizes several methods to configure as appropriate:  configuration files located at  `configs`, environment variables defined when starting our Python backend application as, the UI and API configurations through the `WebUI`. The backend reads configurations as `json`, so any modifications can affect application behavior.

For setting the MQTT credentials to connect your smart bulbs and devices please ensure a file at root level ` mqtt.json` containing username and passwords are configured. A sample can be provided as well in ` configs`. This configuration allows your appliances connected on the Zigbee / Zibgee protocol communicate via that.

We support different levels of access with role and users configuration in our `db`, where different access to API and web UI are available and restricted for safety, with multiple authentication and authorisation mechanism, such as password hashing via salted bcrypt algorithms and API authentication.  We are constantly trying expand on that security feature,

To change database details or the port server is using is very easily, just configure a `.env` located on the top level folder that defines a number of configuration settings, with a format similar to:  `DATABASE_URL="postgresql://user:password@host:port/database"`, for setting a connection URL as example.
While not mandatory we recommend a .env for portability of configuration across different enviroments such that your configurations stay on your development machines but easy deploy to any infrastructure with ease and security of configuration, with minimum effort on a new server setup
This should improve deployment experience as we aim on having it fully container friendly in near time.
For a comprehensive view on each configurations and parameters usage check API or help .json in configuration folder to know which ones can modify.
We always aim ease in the useability of these settings to provide users a flexible experience with SmartHomeManager to suit certain preferences and security needs

## Project Structure
The core directory contains our code. Here\'s a detailed description.

`configs/`: This is the configuration management. Includes configuration file and API credentials. The configuration can be easily changed, without modifying any code within it
`db/`:  Containing the schema migration files, for database versioning as our database is Postgresql- based application that evolves and scales
`models/`: Python code containing database models as objects, and managing relationships in data between our database entries. A very important piece in managing data in the project.
`api/`: API endpoints definition for handling incoming API queries for all device and sensors available. The entry points into application's functionalities and services for the external system
`src/`: Main Python modules.
`static/`: Static HTML resources (for frontend deployment if using traditional methods) for our Web UI, containing Javascript assets for interactive components on UI to work, like dynamic forms and device control panel and charts
`tests/`: All unit/ integrations tests are here
`web_ui/`: Contains all front end resources using a `React` application and a simple deployment configuration, to deploy a Javascript based web user friendly application that controls your house, using all of our backend APIs

Overall a simple layout that promotes readability and maintenance. It helps keep things organized

## Contributing
Contributions to SmartHomeManager are encouraged. This ensures community engagement for improvements

Please read and abide to existing guidelines before making your own Change Requests (Pull Request in `Github`) as we expect all submissions have proper and adequate tests to prevent breaking existing system behavior.
All new functionalities or enhancements requires an issue report prior, so you can be aware what has to do to align and follow with existing project guidelines. The issues must contain a description, steps needed to recreate and expected behaviour, as to avoid confusion, or wasted of resources and prevent any misunderstandings.

We also have some standards on style. Follow a `black` formatter style with consistent code style and high-quality commits. We are very keen for having all changes thoroughly verified before they reach our release pipeline to avoid errors to our end-users

To help our developers, it can always be a great help for providing bug report or enhancement proposals and also suggest fixes or contribute on documentation, all contributions help and make this product better than it's right now! We always appreciate your feedback.

## License
This project is licensed under the MIT License. By using this software, you agree to the terms and conditions of this license. The use for the project are free, with minimum obligations. Redistribution are freely welcome with the same MIT license applied, as you acknowledge its authorship. 

This licensing ensures flexibility for developers to incorporate the technology within other platforms while also promoting an accessible, open environment with no restrictions or limitations in using, sharing, copying or changing our code. It encourages community contribution for the product and its growth and innovation in an environment where all parties benefit and share their knowledge to each others to build an ecosystem together.

## Acknowledgments
The developers of SmartHomeManager want to give credit for this product to the libraries for our core functionalities and technologies: The libraries for asynchronous processing (asyncio) , our Python standard tools, React libraries as frontend, database libraries like SQLAlchemy with PostgreSQL for simplified interactions. And last and important is Zigbee- 2mqtt open source and other related communities and open resources that helped and enabled building of integrations and communication.
Also thanks the many online developers and their valuable content that inspired this effort as they have given great knowledge about how to implement and build efficient, and scalable applications with security best- practices, for building such a system like SmartHomeManager
Lastly to all users testing it on different devices or hardware, the community support for providing valuable feedbacks, for making such effort as a great collaborative environment to make a difference

## System Architecture
Our design emphasizes the flexibility that allows users adapt it easily with the devices on a home environment, as a core concept to build upon a reliable architecture

A main backend is written using `Python 3.9`. It is responsible of processing sensor inputs from a network using an HTTP Rest API. This is the communication interface, for controlling the house, receiving commands through HTTP protocol, or via `WebSocket + RESTful APIs` .

All sensor input and output devices connect through the central controller that uses various drivers, for communicating, for a synchronized management. Important parts is asynchronous communication between the controller as backend application as we utilize a high degree of non blocking processing, which is necessary for managing large data volumes and maintaining real-time device management as well
Data persists via relational database management (PostgreSQL, version 13+) storing sensor measurements as historical and current events, and the house devices state

Finally is presented an interactive, HTML-JavaScript front end interface for controlling a devices via `REST`, schedules as configuration parameters in database via interactive form and dynamic charts

## API Reference
This application's functionalities exposed over API using a well organized documentation, which helps to manage and build integration.  It follows HTTP REST standard and is simple

`/api/devices/`: Endpoint returning an JSON response containing a full inventory devices and associated sensors

`/api/devices/<device_ID>`:  Endpoint allowing retrieving details about device such a type of equipment or associated properties
`/api/devices/<device_ID>/on`: Turning specific device to a specific state such ON or OFF state, with immediate impact
`/api/sensors/<sensor_ID>/current`: Getting real time data about sensors as temperatures as pressure and more
`/api/schemas`: API endpoint providing access schema and available data, allowing external integrations and data analytics applications and other services to be able consume this system as data provider and source with easy integration with a standardized output

## Testing
Tests cover different components in system as a safety and validation layer for a production ready state

Run integration/ units with  ` ./scripts/run_tests.sh`.  This command utilizes  a virtual python test suite environment to run automated code tests

Mock environments for specific drivers or network protocols for isolated test.

The goal in automated system tests, with 95+ lines test coverage, that validates every aspect and functionalities with the application before pushing it toward Public and user testing and production release. It also simulate various errors scenarios such a device failures as a way ensure the code and business logics are robust against unforeseen errors
It helps developers prevent breaking changes when introducing changes on core code

## Troubleshooting
Common installation problem: `Missing libraries`: Run installation step in terminal `python setup.py install`, with admin credentials or using a virtualenv as suggested previously due conflicts and permissions on local systems,

`Sensor Data Not Reported` Check if device and drivers were detected properly by application by looking log output in the console. Verify connection physical, if needed

If `Device control is delayed`:  Verify if network congestion is causing an issue to send and/ receive communication with your device as latency in your devices or connection, with slow or delayed feedback as response
If you can't start server with database errors ensure proper database settings with database connection strings configured on .env file
Check API Documentation as guide. If you still experiencing issues with SmartHomeManager, consider creating issues in repository with clear logs as error, steps with reproduction to make tracking easier to find and address potential errors
Please ensure logs and debugging messages, are clear, concise. And well organized for developers to debug easier the problems in system


## Performance and Optimization
Caching data in a in-memory storage helps reducing read from databases, which is a significant speedup on data processing with real-time metrics on devices as temperature

Concurrency managing tasks using `AsyncIO `allows us handle large stream and volume in real time with high concurrency and performance with asynchronous processing for device controls without freezing any operations as they execute

Using database index optimization and data partition to enhance read times on queries and improve the query execution as faster in data retrievals with improved efficiency as performance and database load, in our relational database as PostgreSQL with indexes for frequent query
We have several benchmarks to monitor key metrics of applications and identify slow or expensive components, with profiling tool as `line_profiler `and others tools help optimize resource consumption for efficient usage, in both code or system level.


## Security Considerations
Sensitive information as database user password is never stored plain-text. Instead are managed by encryption as `Salted` bcrypt algorithm
Authentication of every access with multiple factors is necessary using `OAuth-based mechanisms` as well, with robust and validated input from external API calls
Always make updates of packages and security patch from dependencies, which prevents any exploits from access. Regularly review all the dependencies of this product
Security testing and audits performed, as we scan for code vulnerability using dedicated tools as OWASP and security standards
Implement robust security standards, for a better security, by regularly scanning your network to look vulnerabilities with intrusion systems to scan and detect potential breaches

## Roadmap
Planned feature include: Support to additional smart-device integrations via Zwave and other standard
Advanced AI based predictive analytics for heating systems. It helps optimizing power usage
Implement support multi tenant cloud deployments
Improve and add better data- privacy and data control to users as primary focus
Automated vulnerability assessment to scan and prevent new exploits and threats to keep application safe

## FAQ (Frequently Asked Questions)
*Cannot find my Z-Wave Device:* First, try power cycling device as the most usual issue for a communication. Make sure it in close and good connection proximity as USB Dongle, if not retry reconfigure.  Check driver modules if not available as driver module and reinstall it,

*Device Control Is Lagging?:*  Make sure no interference on wireless signals from appliances nearby and devices connected via Zibbee protocols.
Check device drivers. Try add device and drivers again if issues remain*  Check connection stability. Check network congestion and look if you are using a slow device

*Web UI Not Responding:* If UI is unresponsive and the system has crashed or the backend is having connection.  Verify database and restart services if any errors found
Clear Browser data as Cache or similar artifacts

## Citation
If utilizing the software as source, for research, publications or presentations it will require citing. Please follow this reference

Author: SmartHomeManager team.
Year: 2024
Title: SmartHomeManager: A Distributed Platform for Automating Smart Devices
Repository: `[Repository url, for citation and updates, as a reference guide.]`
Software version `SmartHomeManager v.2.0 Beta Release `



## Contact
Please visit github repository `https://github.com/orgname/project` and contact with developer via github as well, for feedback as issue reports with feature proposals and suggestions
Join online community channels, to discuss with fellow developers to help build community awareness on product

For commercial and partnership contact email `support@smart.com`